warn()
warnings()
mData <- matrix(c(0,      1,50,
26.4,  13,50,
53.6,  14,50,
107.1, 25,50),nrow=4,ncol=3,byrow=T)
library(ToxicR)
Q = ma_dichotomous_fit(mData[,1],mData[,2],mData[,3],
fit_type = "mcmc")
Q$bmd
Q = ma_dichotomous_fit(mData[,1],mData[,2],mData[,3],
fit_type = "laplace")
Q$BMD_CDF
plot(Q)
library(ggplot2)
plot(Q)
Q = ma_dichotomous_fit(mData[,1],mData[,2],mData[,3],
fit_type = "mcmc")
plot(Q)
mData <- matrix(c(0,      1,50,
26.4,   3,50,
53.6,  14,50,
107.1, 25,50),nrow=4,ncol=3,byrow=T)
Q = ma_dichotomous_fit(mData[,1],mData[,2],mData[,3],
fit_type = "mcmc")
Q$bmd
Q = ma_dichotomous_fit(mData[,1],mData[,2],mData[,3],
fit_type = "laplace")
Q$BMD_CDF
plot(Q)
Q = ma_dichotomous_fit(mData[,1],mData[,2],mData[,3],
fit_type = "mcmc")
plot(Q)
c = single_continuous_fit(M2[,1,drop=F],M2[,2:4],sstat=T,BMD_TYPE="rel",BMR=0.9, distribution = "lognormal",fit_type="mcmc",model_type = "exp-5")
library(ToxicR)
c = single_continuous_fit(M2[,1,drop=F],M2[,2:4],sstat=T,BMD_TYPE="rel",BMR=0.9, distribution = "lognormal",fit_type="mcmc",model_type = "exp-5")
library(ToxicR)
M2           <- matrix(0,nrow=5,ncol=4)
colnames(M2) <- c("Dose","Resp","N","StDev")
M2[, 1]      <- c(0,25,50,100,200)
M2[, 2]      <- c(6.0, 5.2, 2.4, 1.1, 0.75)
M2[, 3]      <- c(20,20,19,20,20)
M2[, 4]      <- c(1.2,1.1,0.81,0.74,0.66)
y <- list()
doses<- list()
for (ii in 1:nrow(M2)){
}
c = single_continuous_fit(M2[,1,drop=F],M2[,2:4],sstat=T,BMD_TYPE="rel",BMR=0.9, distribution = "lognormal",fit_type="mcmc",model_type = "exp-5")
plot(c)
library(ggplot2)
plot(c)
c = single_continuous_fit(M2[,1,drop=F],M2[,2:4],sstat=T,BMD_TYPE="sd",BMR=1, distribution = "lognormal",fit_type="mcmc",model_type = "exp-5")
plot(c)
c = single_continuous_fit(M2[,1,drop=F],M2[,2:4],sstat=T,BMD_TYPE="sd",BMR=1, distribution = "lognormal",fit_type="laplace",model_type = "exp-5")
plot(c)
c = single_continuous_fit(M2[,1,drop=F],M2[,2:4],sstat=T,BMD_TYPE="hybrid",BMR=0.1, distribution = "lognormal",fit_type="laplace",model_type = "exp-5")
plot(c)
c = single_continuous_fit(M2[,1,drop=F],M2[,2:4],sstat=T,BMD_TYPE="sd",BMR=1, distribution = "normal",fit_type="laplace",model_type = "exp-5")
plot(c)
plot(c) + scale_x_log10()
c$parameters
(exp(exp(-0.183)) - 1)*exp(2*log(6)+exp(-0.183))
(exp(-0.183) - 1)*exp(2*log(6)+exp(-0.183))
exp(-0.183)
c = single_continuous_fit(M2[,1,drop=F],M2[,2:4],sstat=T,BMD_TYPE="sd",BMR=1, distribution = "normal",fit_type="laplace",model_type = "exp-5")
c$parameters
setwd("~/Documents")
setwd("~/Documents/r_software/RBMDS/ToxicR/R")
exp(-0.183)
(exp(0.832)-1)
(exp(0.832)-1)*exp(2*log(6)+exp(0.832))
(exp(0.832)-1)*exp(2*log(6)+0.832)
log(5)
c = single_continuous_fit(M2[,1,drop=F],M2[,2:4],sstat=T,BMD_TYPE="sd",BMR=1, distribution = "normal",fit_type="laplace",model_type = "exp-5")
c$parameters
c = single_continuous_fit(M2[,1,drop=F],M2[,2:4],sstat=T,BMD_TYPE="sd",BMR=1, distribution = "lognormal",fit_type="laplace",model_type = "exp-5")
c$parameters
exp(-1.202)
exp(0.3)-1
0.3499*(exp(2*log(5.38)+0.349))
sqrt(0.3499*(exp(2*log(5.38)+0.349)))
plot(c)
c$bmd
x <- rlnorm(30000,log(5.379,exp(-1.202)))
var(x)
x <- rlnorm(30000,log(5.379),exp(-1.202))
var(x)
exp(-1.202)
exp(-1.202) - 1
exp(0.3005)-1
exp(2*log(5.379)+exp(-1.202))
exp(2*log(5.379)+exp(-1.202))*0.35
x <- rlnorm(300000,log(5.379),exp(-1.202))
var(x)
sd(x)
c$bmd_dist
exp(-1.202)
exp(2*-1.202)
exp(0.0904)-1
0.0946*exp(2*log(5.379)+0.0904)
x <- rlnorm(300000,log(5.379),sqrt(exp(-1.202)))
var(x)
sqrt(13.69)
c = single_continuous_fit(M2[,1,drop=F],M2[,2:4],sstat=T,BMD_TYPE="sd",BMR=0.1, distribution = "lognormal",fit_type="laplace",model_type = "exp-5")
c$bmd
c = single_continuous_fit(M2[,1,drop=F],M2[,2:4],sstat=T,BMD_TYPE="sd",BMR=0.3, distribution = "lognormal",fit_type="laplace",model_type = "exp-5")
plot(c)
c = single_continuous_fit(M2[,1,drop=F],M2[,2:4],sstat=T,BMD_TYPE="sd",BMR=0.4, distribution = "lognormal",fit_type="laplace",model_type = "exp-5")
plot(c)
c = single_continuous_fit(M2[,1,drop=F],M2[,2:4],sstat=T,BMD_TYPE="sd",BMR=0.6, distribution = "lognormal",fit_type="laplace",model_type = "exp-5")
plot(c)
is.nan(c$bmd)
is.na(c$bmd)
sum(is.na(c$bmd))
!sum(is.na(c$bmd))
library(ToxicR)
library(ggplot2)
plot(c)
c = single_continuous_fit(M2[,1,drop=F],M2[,2:4],sstat=T,BMD_TYPE="sd",BMR=0.5, distribution = "lognormal",fit_type="laplace",model_type = "exp-5")
plot(c)
c = single_continuous_fit(M2[,1,drop=F],M2[,2:4],sstat=T,BMD_TYPE="sd",BMR=0.4, distribution = "lognormal",fit_type="laplace",model_type = "exp-5")
plot(c)
c = single_continuous_fit(M2[,1,drop=F],M2[,2:4],sstat=T,BMD_TYPE="hybrid",BMR=0.1, distribution = "lognormal",fit_type="laplace",model_type = "exp-5")
plot(c)
plot(c) + scale_x_sqrt()
plot(bb)
plot(BB)
BB
plot(BB)
library(ToxicR)
library(ggplot2)
v1 <- c(13.184152,12.8906975,12.359554,13.073001,12.861814,12.967434,12.88052,
13.249991,	12.992931,	13.022338,	13.614057,	13.287018,	13.449239,	13.950747,
13.239134,	13.82321,	15.080262,	14.85966,	14.7805395,	15.238369,	14.749196,
14.913585,	15.181719,	15.051697,	15.065641,	15.16396,	15.484345,	16.493923,
15.633442,	15.96033,	15.388061)
prior <- create_prior_list(lnormprior(0,1,-100,100),
normprior( 0, 1,-100,100),#normprior(1,2,-18,18),
lnormprior(0 ,1,0,100),
lnormprior(0,1,0,18),
normprior(0,2,-18,18));
library(readr)
PFOA_Liver <- read_table2("~/Documents/PFOA_Liver.txt",
col_names = FALSE)
doses	<- c(0,	0,	0,	0,	0.156,	0.156,	0.156,	0.3125,	0.3125,	0.3125,
0.625,	0.625,	0.625,	1.25,	1.25,	1.25,	2.5,	2.5,	2.5,	5,5,
5,	5,	10,	10,	10,	10,	20,	20,	20,	20)
#B <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", fit_type = "mle",sstat = F)
#BB <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal",fit_type = "mle",sstat = F,)
library(dplyr)
library(ToxicR)
temp <- PFOA_Liver %>% filter(X1 == "ABCG2_32656")
v1 <- as.numeric(temp[2:length(temp)])
B  <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal-ncv",fit_type = "laplace",BMR = 2,sstat = F,isFast = FALSE)
plot(B)
model_list  = data.frame(model_list = c(rep("hill",2),rep("exp-3",2),rep("exp-5",2),rep("power",2)),
distribution_list =  c(c("normal","normal-ncv"),rep(c("normal","normal-ncv"),2),
"normal", "normal-ncv"))
BB <- ma_continuous_fit(as.matrix(doses),as.matrix(v1),fit_type = "mcmc",BMR = 2.05,model_list = model_list )
plot(BB)
library(ToxicR)
library(ggplot2)
v1 <- c(13.184152,12.8906975,12.359554,13.073001,12.861814,12.967434,12.88052,
13.249991,	12.992931,	13.022338,	13.614057,	13.287018,	13.449239,	13.950747,
13.239134,	13.82321,	15.080262,	14.85966,	14.7805395,	15.238369,	14.749196,
14.913585,	15.181719,	15.051697,	15.065641,	15.16396,	15.484345,	16.493923,
15.633442,	15.96033,	15.388061)
prior <- create_prior_list(lnormprior(0,1,-100,100),
normprior( 0, 1,-100,100),#normprior(1,2,-18,18),
lnormprior(0 ,1,0,100),
lnormprior(0,1,0,18),
normprior(0,2,-18,18));
library(readr)
PFOA_Liver <- read_table2("~/Documents/PFOA_Liver.txt",
col_names = FALSE)
doses	<- c(0,	0,	0,	0,	0.156,	0.156,	0.156,	0.3125,	0.3125,	0.3125,
0.625,	0.625,	0.625,	1.25,	1.25,	1.25,	2.5,	2.5,	2.5,	5,5,
5,	5,	10,	10,	10,	10,	20,	20,	20,	20)
#B <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", fit_type = "mle",sstat = F)
#BB <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal",fit_type = "mle",sstat = F,)
library(dplyr)
library(ToxicR)
temp <- PFOA_Liver %>% filter(X1 == "ABCG2_32656")
v1 <- as.numeric(temp[2:length(temp)])
B  <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal-ncv",fit_type = "laplace",BMR = 2,sstat = F,isFast = FALSE)
plot(B)
model_list  = data.frame(model_list = c(rep("hill",2),rep("exp-3",2),rep("exp-5",2),rep("power",2)),
distribution_list =  c(c("normal","normal-ncv"),rep(c("normal","normal-ncv"),2),
"normal", "normal-ncv"))
BB <- ma_continuous_fit(as.matrix(doses),as.matrix(v1),fit_type = "laplace",BMR = 2.05,model_list = model_list )
plot(BB)
library(ToxicR)
library(ggplot2)
v1 <- c(13.184152,12.8906975,12.359554,13.073001,12.861814,12.967434,12.88052,
13.249991,	12.992931,	13.022338,	13.614057,	13.287018,	13.449239,	13.950747,
13.239134,	13.82321,	15.080262,	14.85966,	14.7805395,	15.238369,	14.749196,
14.913585,	15.181719,	15.051697,	15.065641,	15.16396,	15.484345,	16.493923,
15.633442,	15.96033,	15.388061)
prior <- create_prior_list(lnormprior(0,1,-100,100),
normprior( 0, 1,-100,100),#normprior(1,2,-18,18),
lnormprior(0 ,1,0,100),
lnormprior(0,1,0,18),
normprior(0,2,-18,18));
library(readr)
PFOA_Liver <- read_table2("~/Documents/PFOA_Liver.txt",
col_names = FALSE)
doses	<- c(0,	0,	0,	0,	0.156,	0.156,	0.156,	0.3125,	0.3125,	0.3125,
0.625,	0.625,	0.625,	1.25,	1.25,	1.25,	2.5,	2.5,	2.5,	5,5,
5,	5,	10,	10,	10,	10,	20,	20,	20,	20)
#B <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", fit_type = "mle",sstat = F)
#BB <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal",fit_type = "mle",sstat = F,)
library(dplyr)
library(ToxicR)
temp <- PFOA_Liver %>% filter(X1 == "ABCG2_32656")
v1 <- as.numeric(temp[2:length(temp)])
B  <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal-ncv",fit_type = "laplace",BMR = 2,sstat = F,isFast = FALSE)
plot(B)
model_list  = data.frame(model_list = c(rep("hill",2),rep("exp-3",2),rep("exp-5",2),rep("power",2)),
distribution_list =  c(c("normal","normal-ncv"),rep(c("normal","normal-ncv"),2),
"normal", "normal-ncv"))
BB <- ma_continuous_fit(as.matrix(doses),as.matrix(v1),fit_type = "mcmc",BMR = 2.05,model_list = model_list )
BB <- ma_continuous_fit(as.matrix(doses),as.matrix(v1),fit_type = "mcmc",BMR = 2.05,model_list = model_list )
plot(BB)
BB$bmd
library(ToxicR)
library(ggplot2)
v1 <- c(13.184152,12.8906975,12.359554,13.073001,12.861814,12.967434,12.88052,
13.249991,	12.992931,	13.022338,	13.614057,	13.287018,	13.449239,	13.950747,
13.239134,	13.82321,	15.080262,	14.85966,	14.7805395,	15.238369,	14.749196,
14.913585,	15.181719,	15.051697,	15.065641,	15.16396,	15.484345,	16.493923,
15.633442,	15.96033,	15.388061)
prior <- create_prior_list(lnormprior(0,1,-100,100),
normprior( 0, 1,-100,100),#normprior(1,2,-18,18),
lnormprior(0 ,1,0,100),
lnormprior(0,1,0,18),
normprior(0,2,-18,18));
library(readr)
PFOA_Liver <- read_table2("~/Documents/PFOA_Liver.txt",
col_names = FALSE)
doses	<- c(0,	0,	0,	0,	0.156,	0.156,	0.156,	0.3125,	0.3125,	0.3125,
0.625,	0.625,	0.625,	1.25,	1.25,	1.25,	2.5,	2.5,	2.5,	5,5,
5,	5,	10,	10,	10,	10,	20,	20,	20,	20)
#B <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", fit_type = "mle",sstat = F)
#BB <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal",fit_type = "mle",sstat = F,)
library(dplyr)
library(ToxicR)
temp <- PFOA_Liver %>% filter(X1 == "ABCG2_32656")
v1 <- as.numeric(temp[2:length(temp)])
B  <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal-ncv",fit_type = "laplace",BMR = 2,sstat = F,isFast = FALSE)
plot(B)
model_list  = data.frame(model_list = c(rep("hill",2),rep("exp-3",2),rep("exp-5",2),rep("power",2)),
distribution_list =  c(c("normal","normal-ncv"),rep(c("normal","normal-ncv"),2),
"normal", "normal-ncv"))
BB <- ma_continuous_fit(as.matrix(doses),as.matrix(v1),fit_type = "mcmc",BMR = 2.05,model_list = model_list )
plot(BB)
BB$posterior_probs
library(ToxicR)
library(ggplot2)
v1 <- c(13.184152,12.8906975,12.359554,13.073001,12.861814,12.967434,12.88052,
13.249991,	12.992931,	13.022338,	13.614057,	13.287018,	13.449239,	13.950747,
13.239134,	13.82321,	15.080262,	14.85966,	14.7805395,	15.238369,	14.749196,
14.913585,	15.181719,	15.051697,	15.065641,	15.16396,	15.484345,	16.493923,
15.633442,	15.96033,	15.388061)
prior <- create_prior_list(lnormprior(0,1,-100,100),
normprior( 0, 1,-100,100),#normprior(1,2,-18,18),
lnormprior(0 ,1,0,100),
lnormprior(0,1,0,18),
normprior(0,2,-18,18));
library(readr)
PFOA_Liver <- read_table2("~/Documents/PFOA_Liver.txt",
col_names = FALSE)
doses	<- c(0,	0,	0,	0,	0.156,	0.156,	0.156,	0.3125,	0.3125,	0.3125,
0.625,	0.625,	0.625,	1.25,	1.25,	1.25,	2.5,	2.5,	2.5,	5,5,
5,	5,	10,	10,	10,	10,	20,	20,	20,	20)
#B <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", fit_type = "mle",sstat = F)
#BB <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal",fit_type = "mle",sstat = F,)
library(dplyr)
library(ToxicR)
temp <- PFOA_Liver %>% filter(X1 == "ABCG2_32656")
v1 <- as.numeric(temp[2:length(temp)])
B  <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal-ncv",fit_type = "laplace",BMR = 2,sstat = F,isFast = FALSE)
plot(B)
model_list  = data.frame(model_list = c(rep("hill",2),rep("exp-3",2),rep("exp-5",2),rep("power",2)),
distribution_list =  c(c("normal","normal-ncv"),rep(c("normal","normal-ncv"),2),
"normal", "normal-ncv"))
BB <- ma_continuous_fit(as.matrix(doses),as.matrix(v1),fit_type = "mcmc",BMR = 2.05,model_list = model_list )
plot(BB)
A = BB
qprob=0.05
density_col="blueviolet"
credint_col="azure2"
class_list <- names(A)
fit_idx    <- grep("Individual_Model",class_list)
n_samps <- nrow(A[[fit_idx[1]]]$mcmc_result$PARM_samples)
data_d   <-  A[[fit_idx[1]]]$data
max_dose <- max(data_d[,1])
min_dose <- min(data_d[,1])
test_doses <- seq(min_dose,max_dose,(max_dose-min_dose)/200);
ma_samps <- sample(fit_idx,n_samps, replace=TRUE,prob = A$posterior_probs)
temp_f   <- matrix(0,n_samps,length(test_doses))
temp_bmd <- rep(0,length(test_doses))
if (ncol(data_d) == 4 ){ #sufficient statistics
mean <- data_d[,2,drop=F]
se   <- data_d[,4,drop=F]/sqrt(fit$data[,3,drop=F])
doses = data_d[,1,drop=F]
uerror <- mean+se
lerror <- mean-se
dose = c(doses,doses)
Response = c(uerror,lerror)
lm_fit = lm(mean ~ doses,weights = 1/se*se)
}else{
Response <- data_d[,2,drop=F]
doses = data_d[,1,drop=F]
lm_fit = lm(Response~doses)
}
if (coefficients(lm_fit)[2] < 0){
decrease = TRUE
}else{
decrease = FALSE
}
print ("I am here")
for (ii in 1:n_samps){
fit <- A[[fit_idx[ma_samps[ii]]]]
if (fit$model=="FUNL"){
temp_f[ii,] <- cont_FUNL_f(fit$mcmc_result$PARM_samples[ii,],test_doses)
temp_bmd[ii] <- fit$mcmc_result$BMD_samples[ii]
}
if (fit$model=="hill"){
temp_f[ii,] <- cont_hill_f(fit$mcmc_result$PARM_samples[ii,],test_doses)
temp_bmd[ii] <- fit$mcmc_result$BMD_samples[ii]
}
if (fit$model=="exp-3"){
temp_f[ii,] <- cont_exp_3_f(fit$mcmc_result$PARM_samples[ii,],test_doses,decrease)
temp_bmd[ii] <- fit$mcmc_result$BMD_samples[ii]
}
if (fit$model=="exp-5"){
temp_f[ii,] <- cont_exp_5_f(fit$mcmc_result$PARM_samples[ii,],test_doses)
temp_bmd[ii] <- fit$mcmc_result$BMD_samples[ii]
}
if (fit$model=="power"){
temp_f[ii,] <- cont_power_f(fit$mcmc_result$PARM_samples[ii,],test_doses)
temp_bmd[ii] <- fit$mcmc_result$BMD_samples[ii]
}
}
temp_f[is.infinite(temp_f)] = NA
me <- colMeans(temp_f,na.rm = TRUE)
lq <- apply(temp_f,2,quantile, probs = qprob,na.rm = TRUE)
uq <- apply(temp_f,2,quantile, probs = 1-qprob,na.rm = TRUE)
print ("I am here 2.0")
plot_gg<-ggplot()+
geom_point(aes(x=doses,y=Response))+
xlim(c(min(doses),max(doses)*1.03))+
labs(x="Dose", y="Proportion",title="Continous MA fitting")+
theme_minimal()
plot_gg
plot_gg<-plot_gg+
geom_ribbon(aes(x=test_doses,ymin=lq,ymax=uq),fill="blue",alpha=0.1)
plot_gg
plot_gg<-plot_gg+
geom_line(aes(x=test_doses,y=me),col="blue",size=2)
plot_gg
plot_gg<-ggplot()+
geom_point(aes(x=doses,y=Response))+
xlim(c(min(doses),max(doses)*1.03))+
labs(x="Dose", y="Proportion",title="Continous MA fitting")+
theme_minimal()
plot_gg<-plot_gg+
geom_ribbon(aes(x=test_doses,ymin=lq,ymax=uq),fill="blue",alpha=0.1)
plplot_gg
plot_gg
plot(test_doses,me)
me
plot(test_doses,temp_f[ii,])
plot(test_doses,temp_f[1,])
plot(test_doses,temp_f[2,])
plot(test_doses,temp_f[3,])
plot(test_doses,temp_f[4,])
plot(test_doses,temp_f[100,])
ma_samps
unique(ma_samps)
which(ma_samps==2)
plot(test_doses,temp_f[150,])
which(ma_samps==3)
plot(test_doses,temp_f[159,])
which(ma_samps==7)
plot(test_doses,temp_f[11799,])
temp_f[is.infinite(temp_f)] = NA
temp_f[abs(temp_f) > 1e10] = NA
me <- colMeans(temp_f,na.rm = TRUE)
lq <- apply(temp_f,2,quantile, probs = qprob,na.rm = TRUE)
uq <- apply(temp_f,2,quantile, probs = 1-qprob,na.rm = TRUE)
plot_gg<-ggplot()+
geom_point(aes(x=doses,y=Response))+
xlim(c(min(doses),max(doses)*1.03))+
labs(x="Dose", y="Proportion",title="Continous MA fitting")+
theme_minimal()
plot_gg<-plot_gg+
geom_ribbon(aes(x=test_doses,ymin=lq,ymax=uq),fill="blue",alpha=0.1)
plot_gg<-plot_gg+
geom_line(aes(x=test_doses,y=me),col="blue",size=2)
plot_gg<-ggplot()+
geom_point(aes(x=doses,y=Response))+
xlim(c(min(doses),max(doses)*1.03))+
labs(x="Dose", y="Proportion",title="Continous MA fitting")+
theme_minimal()
plot_gg<-plot_gg+
geom_ribbon(aes(x=test_doses,ymin=lq,ymax=uq),fill="blue",alpha=0.1)
plot_gg<-plot_gg+
geom_line(aes(x=test_doses,y=me),col="blue",size=2)
plot_gg
temp_f[is.infinite(temp_f)] = NA
temp_f[abs(temp_f) > 1e10] = NA
me <- apply(temp_f,2,quantile, probs = 0.5,na.rm = TRUE)
lq <- apply(temp_f,2,quantile, probs = qprob,na.rm = TRUE)
uq <- apply(temp_f,2,quantile, probs = 1-qprob,na.rm = TRUE)
plot_gg<-ggplot()+
geom_point(aes(x=doses,y=Response))+
xlim(c(min(doses),max(doses)*1.03))+
labs(x="Dose", y="Proportion",title="Continous MA fitting")+
theme_minimal()
plot_gg<-plot_gg+
geom_ribbon(aes(x=test_doses,ymin=lq,ymax=uq),fill="blue",alpha=0.1)
plot_gg<-plot_gg+
geom_line(aes(x=test_doses,y=me),col="blue",size=2)
plot_gg
BB$posterior_probs
library(ToxicR)
library(ggplot2)
M2           <- matrix(0,nrow=5,ncol=4)
colnames(M2) <- c("Dose","Resp","N","StDev")
M2[, 1]      <- c(0,25,50,100,200)
M2[, 2]      <- c(6.0, 5.2, 2.4, 1.1, 0.75)
M2[, 3]      <- c(20,20,19,20,20)
M2[, 4]      <- c(1.2,1.1,0.81,0.74,0.66)
y <- list()
doses<- list()
for (ii in 1:nrow(M2)){
}
c = single_continuous_fit(M2[,1,drop=F],M2[,2:4],sstat=T,BMD_TYPE="hybrid",BMR=0.1, distribution = "lognormal",fit_type="laplace",model_type = "exp-5")
plot(c)
plot(BB)+scale_x_sqrt()
plot(BB)
plot(BB)
library(ToxicR)
plot(BB)
library(ggplot2)
plot(BB)
plot(BB) + scale_x_sqrt()
plot(BB)
plot(BB) + scale_x_sqrt()
BB <- ma_continuous_fit(as.matrix(doses),as.matrix(v1),fit_type = "mcmc",BMR = 1.0,model_list = model_list )
library(ToxicR)
library(ggplot2)
v1 <- c(13.184152,12.8906975,12.359554,13.073001,12.861814,12.967434,12.88052,
13.249991,	12.992931,	13.022338,	13.614057,	13.287018,	13.449239,	13.950747,
13.239134,	13.82321,	15.080262,	14.85966,	14.7805395,	15.238369,	14.749196,
14.913585,	15.181719,	15.051697,	15.065641,	15.16396,	15.484345,	16.493923,
15.633442,	15.96033,	15.388061)
prior <- create_prior_list(lnormprior(0,1,-100,100),
normprior( 0, 1,-100,100),#normprior(1,2,-18,18),
lnormprior(0 ,1,0,100),
lnormprior(0,1,0,18),
normprior(0,2,-18,18));
library(readr)
PFOA_Liver <- read_table2("~/Documents/PFOA_Liver.txt",
col_names = FALSE)
doses	<- c(0,	0,	0,	0,	0.156,	0.156,	0.156,	0.3125,	0.3125,	0.3125,
0.625,	0.625,	0.625,	1.25,	1.25,	1.25,	2.5,	2.5,	2.5,	5,5,
5,	5,	10,	10,	10,	10,	20,	20,	20,	20)
#B <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", fit_type = "mle",sstat = F)
#BB <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal",fit_type = "mle",sstat = F,)
library(dplyr)
library(ToxicR)
temp <- PFOA_Liver %>% filter(X1 == "ABCG2_32656")
v1 <- as.numeric(temp[2:length(temp)])
B  <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal-ncv",fit_type = "laplace",BMR = 2,sstat = F,isFast = FALSE)
plot(B)
model_list  = data.frame(model_list = c(rep("hill",2),rep("exp-3",2),rep("exp-5",2),rep("power",2)),
distribution_list =  c(c("normal","normal-ncv"),rep(c("normal","normal-ncv"),2),
"normal", "normal-ncv"))
BB <- ma_continuous_fit(as.matrix(doses),as.matrix(v1),fit_type = "mcmc",BMR = 1.0,model_list = model_list )
plot(BB)
plot(BB) + sqrt()
plot(BB) + scale_x_sqrt()
BB <- ma_continuous_fit(as.matrix(doses),as.matrix(v1),fit_type = "mcmc",BMR = 0.5,model_list = model_list )
plot(BB)
plot(BB) + scale_x_sqrt()
plot(BB) + scale_x_log10()
plot(BB) + scale_x_sqrt()
library(ToxicR)
library(ggplot2)
M2           <- matrix(0,nrow=5,ncol=4)
colnames(M2) <- c("Dose","Resp","N","StDev")
M2[, 1]      <- c(0,25,50,100,200)
M2[, 2]      <- c(6.0, 5.2, 2.4, 1.1, 0.75)
M2[, 3]      <- c(20,20,19,20,20)
M2[, 4]      <- c(1.2,1.1,0.81,0.74,0.66)
y <- list()
doses<- list()
for (ii in 1:nrow(M2)){
}
c = single_continuous_fit(M2[,1,drop=F],M2[,2:4],sstat=T,BMD_TYPE="hybrid",BMR=0.1, distribution = "lognormal",fit_type="laplace",model_type = "exp-5")
plot(c)
c = single_continuous_fit(M2[,1,drop=F],M2[,2:4],sstat=T,BMD_TYPE="hybrid",BMR=0.1, distribution = "normal",fit_type="laplace",model_type = "exp-5")
plot(c)
c = single_continuous_fit(M2[,1,drop=F],M2[,2:4],sstat=T,BMD_TYPE="hybrid",BMR=0.1, distribution = "normal",fit_type="mcmc",model_type = "exp-5")
plot(c)
plot(c) + scale_x_sqrt()
c = single_continuous_fit(M2[,1,drop=F],M2[,2:4],sstat=T,BMD_TYPE="hybrid",BMR=0.1, distribution = "normal",fit_type="laplace",model_type = "exp-5")
plot(c)
c = single_continuous_fit(M2[,1,drop=F],M2[,2:4],sstat=T,BMD_TYPE="hybrid",BMR=0.1, distribution = "normal",fit_type="mle",model_type = "exp-5")
plot(c)
