files <- dir()
ivgSims = grepl("invGaussian",files)
norSims = grepl("normal",files)
lnorSims = grepl("lognormal",files)
cond1 = grepl("sim_1",files)
cond2 = grepl("sim_2",files)
cond3 = grepl("sim_3",files)
cond4 = !(cond1 | cond2 | cond3)
is_geom = grepl("_g_",files)
is_4    = grepl("_4_",files)
lap1.sd <- array(NA,c(4,3,4))
lap2.sd <- array(NA,c(4,3,4))
mcmc1.sd <- array(NA,c(4,3,4))
mcmc2.sd <- array(NA,c(4,3,4))
lap1.h <- array(NA,c(4,3,4))
lap2.h <- array(NA,c(4,3,4))
mcmc1.h <- array(NA,c(4,3,4))
mcmc2.h <- array(NA,c(4,3,4))
for (ii in 1:length(files)){
load(files[ii])
simtype = 1
if (lnorSims[ii] == TRUE){
simtype = 2
}
if (ivgSims[ii] == TRUE){
simtype = 3
}
even = 1
if (is_geom[ii] == TRUE){
even = 3
}
if (!is_4[ii] == TRUE){ # for 5 dose groups
even = even + 1
}
#simulation condition
scond = which(c(cond1[ii],cond2[ii],cond3[ii],cond4[ii]))
true_BMD.h  = BMD.H[scond,simtype]
true_BMD.sd = BMD.SD[scond,simtype]
lap1.sd[scond,simtype,even]  = mean(BMD_result_SD_ML1_lapl[,2] < true_BMD.sd,na.rm=TRUE)
lap2.sd[scond,simtype,even]  = mean(BMD_result_SD_ML2_lapl[,2] < true_BMD.sd,na.rm=TRUE)
mcmc1.sd[scond,simtype,even] = mean(BMD_result_SD_ML1_mcmc[,2]  < true_BMD.sd,na.rm=TRUE)
mcmc2.sd[scond,simtype,even] = mean(BMD_result_SD_ML2_mcmc[,2]  < true_BMD.sd,na.rm=TRUE)
lap1.h[scond,simtype,even]   = mean(BMD_result_HB_ML1_lapl[,2] < true_BMD.h,na.rm=TRUE)
lap2.h[scond,simtype,even]   = mean(BMD_result_HB_ML2_lapl[,2] < true_BMD.h,na.rm=TRUE)
mcmc1.h[scond,simtype,even]  = mean(BMD_result_HB_ML1_mcmc[,2]  < true_BMD.h,na.rm=TRUE)
mcmc2.h[scond,simtype,even]  = mean(BMD_result_HB_ML2_mcmc[,2]  < true_BMD.h,na.rm=TRUE)
}
library(xtable)
SD_no_G_4 <- cbind(lap1.sd[,1,3],lap2.sd[,1,3],mcmc1.sd[,1,3],mcmc2.sd[,1,3])*100
SD_no_G_5 <- cbind(lap1.sd[,1,4],lap2.sd[,1,4],mcmc1.sd[,1,4],mcmc2.sd[,1,4])*100
SD_no_E_4 <- cbind(lap1.sd[,1,1],lap2.sd[,1,1],mcmc1.sd[,1,1],mcmc2.sd[,1,1])*100
SD_no_E_5 <- cbind(lap1.sd[,1,2],lap2.sd[,1,2],mcmc1.sd[,1,2],mcmc2.sd[,1,2])*100
SD_lno_G_4 <- cbind(lap1.sd[,2,3],lap2.sd[,2,3],mcmc1.sd[,2,3],mcmc2.sd[,2,3])*100
SD_lno_G_5 <- cbind(lap1.sd[,2,4],lap2.sd[,2,4],mcmc1.sd[,2,4],mcmc2.sd[,2,4])*100
SD_lno_E_4 <- cbind(lap1.sd[,2,1],lap2.sd[,2,1],mcmc1.sd[,2,1],mcmc2.sd[,2,1])*100
SD_lno_E_5 <- cbind(lap1.sd[,2,2],lap2.sd[,2,2],mcmc1.sd[,2,2],mcmc2.sd[,2,2])*100
SD_ig_G_4 <- cbind(lap1.sd[,3,3],lap2.sd[,3,3],mcmc1.sd[,3,3],mcmc2.sd[,3,3])*100
SD_ig_G_5 <- cbind(lap1.sd[,3,4],lap2.sd[,3,4],mcmc1.sd[,3,4],mcmc2.sd[,3,4])*100
SD_ig_E_4 <- cbind(lap1.sd[,3,1],lap2.sd[,3,1],mcmc1.sd[,3,1],mcmc2.sd[,3,1])*100
SD_ig_E_5 <- cbind(lap1.sd[,3,2],lap2.sd[,3,2],mcmc1.sd[,3,2],mcmc2.sd[,3,2])*100
xtable(cbind(SD_no_E_4,SD_no_G_4), digits = 1)
xtable(cbind(SD_no_E_5,SD_no_G_5), digits = 1)
xtable(cbind(SD_lno_E_4,SD_lno_G_4), digits = 1)
xtable(cbind(SD_lno_E_5,SD_lno_G_5), digits = 1)
xtable(cbind(SD_ig_E_4,SD_ig_G_4), digits = 1)
xtable(cbind(SD_ig_E_5,SD_ig_G_5), digits = 1)
xtable(cbind(SD_no_E_4,SD_no_G_4), digits = 1)
xtable(cbind(SD_no_E_5,SD_no_G_5), digits = 1)
xtable(cbind(SD_lno_E_4,SD_lno_G_4), digits = 1)
xtable(cbind(SD_lno_E_5,SD_lno_G_5), digits = 1)
xtable(cbind(SD_ig_E_4,SD_ig_G_4), digits = 1)
xtable(cbind(SD_ig_E_5,SD_ig_G_5), digits = 1)
HB_no_G_4 <- cbind(lap1.h[,1,3],lap2.h[,1,3],mcmc1.h[,1,3],mcmc2.h[,1,3])*100
HB_no_G_5 <- cbind(lap1.h[,1,4],lap2.h[,1,4],mcmc1.h[,1,4],mcmc2.h[,1,4])*100
HB_no_E_4 <- cbind(lap1.h[,1,1],lap2.h[,1,1],mcmc1.h[,1,1],mcmc2.h[,1,1])*100
HB_no_E_5 <- cbind(lap1.h[,1,2],lap2.h[,1,2],mcmc1.h[,1,2],mcmc2.h[,1,2])*100
HB_lno_G_4 <- cbind(lap1.h[,2,3],lap2.h[,2,3],mcmc1.h[,2,3],mcmc2.h[,2,3])*100
HB_lno_G_5 <- cbind(lap1.h[,2,4],lap2.h[,2,4],mcmc1.h[,2,4],mcmc2.h[,2,4])*100
HB_lno_E_4 <- cbind(lap1.h[,2,1],lap2.h[,2,1],mcmc1.h[,2,1],mcmc2.h[,2,1])*100
HB_lno_E_5 <- cbind(lap1.h[,2,2],lap2.h[,2,2],mcmc1.h[,2,2],mcmc2.h[,2,2])*100
HB_ig_G_4 <- cbind(lap1.h[,3,3],lap2.h[,3,3],mcmc1.h[,3,3],mcmc2.h[,3,3])*100
HB_ig_G_5 <- cbind(lap1.h[,3,4],lap2.h[,3,4],mcmc1.h[,3,4],mcmc2.h[,3,4])*100
HB_ig_E_4 <- cbind(lap1.h[,3,1],lap2.h[,3,1],mcmc1.h[,3,1],mcmc2.h[,3,1])*100
HB_ig_E_5 <- cbind(lap1.h[,3,2],lap2.h[,3,2],mcmc1.h[,3,2],mcmc2.h[,3,2])*100
xtable(cbind(HB_no_E_4,HB_no_G_4), digits = 1)
xtable(cbind(HB_no_E_5,HB_no_G_5), digits = 1)
xtable(cbind(HB_lno_E_4,HB_lno_G_4), digits = 1)
xtable(cbind(HB_lno_E_5,HB_lno_G_5), digits = 1)
xtable(cbind(HB_ig_E_4,HB_ig_G_4), digits = 1)
xtable(cbind(HB_ig_E_5,HB_ig_G_5), digits = 1)
HB_no_G_4 <- cbind(lap1.h[,1,3],lap2.h[,1,3],mcmc1.h[,1,3],mcmc2.h[,1,3])*100
HB_no_G_5 <- cbind(lap1.h[,1,4],lap2.h[,1,4],mcmc1.h[,1,4],mcmc2.h[,1,4])*100
HB_no_E_4 <- cbind(lap1.h[,1,1],lap2.h[,1,1],mcmc1.h[,1,1],mcmc2.h[,1,1])*100
HB_no_E_5 <- cbind(lap1.h[,1,2],lap2.h[,1,2],mcmc1.h[,1,2],mcmc2.h[,1,2])*100
HB_lno_G_4 <- cbind(lap1.h[,2,3],lap2.h[,2,3],mcmc1.h[,2,3],mcmc2.h[,2,3])*100
HB_lno_G_5 <- cbind(lap1.h[,2,4],lap2.h[,2,4],mcmc1.h[,2,4],mcmc2.h[,2,4])*100
HB_lno_E_4 <- cbind(lap1.h[,2,1],lap2.h[,2,1],mcmc1.h[,2,1],mcmc2.h[,2,1])*100
HB_lno_E_5 <- cbind(lap1.h[,2,2],lap2.h[,2,2],mcmc1.h[,2,2],mcmc2.h[,2,2])*100
HB_ig_G_4 <- cbind(lap1.h[,3,3],lap2.h[,3,3],mcmc1.h[,3,3],mcmc2.h[,3,3])*100
HB_ig_G_5 <- cbind(lap1.h[,3,4],lap2.h[,3,4],mcmc1.h[,3,4],mcmc2.h[,3,4])*100
HB_ig_E_4 <- cbind(lap1.h[,3,1],lap2.h[,3,1],mcmc1.h[,3,1],mcmc2.h[,3,1])*100
HB_ig_E_5 <- cbind(lap1.h[,3,2],lap2.h[,3,2],mcmc1.h[,3,2],mcmc2.h[,3,2])*100
xtable(cbind(HB_no_E_4,HB_no_G_4), digits = 1)
xtable(cbind(HB_no_E_5,HB_no_G_5), digits = 1)
xtable(cbind(HB_lno_E_4,HB_lno_G_4), digits = 1)
xtable(cbind(HB_lno_E_5,HB_lno_G_5), digits = 1)
xtable(cbind(HB_ig_E_4,HB_ig_G_4), digits = 1)
xtable(cbind(HB_ig_E_5,HB_ig_G_5), digits = 1)
# Study design drawn from
# https://www.fda.gov/regulatory-information/search-fda-guidance-documents/redbook-2000-ivc3a-short-term-toxicity-studies-rodents#exp
# Means and variances drawn from
# https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3620211/
# Body Weight
library(knitr)
library(ToxicR)
library(actuar)
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
Hill.p <- rbind(c(481,-250.3,70,3.3),
c(481,-250.3,40,1.3),
c(481,-250.2,15,1.1),
c(481,-250.3,50,4) ,
c(10.58,9.7,70,3.5),
c(10.58,9.7,25,3),
c(10.58,9.7,15,2),
c(10.58,9.7,50,4))
hill <- data.frame(a=Hill.p[,1],b=Hill.p[,2],
c=Hill.p[,3],d=Hill.p[,4])
row.names(hill) <- c("Hill Simulation 1","Hill Simulation 2",
"Hill Simulation 3","Hill Simulation 4",
"Hill Simulation 5","Hill Simulation 6",
"Hill Simulation 7","Hill Simulation 8")
#estimates of the Log-normal variance
f1 = function(x){log(exp(x)*expm1(x))-(log(77.5^2) -2*log(481))}
sqrt(uniroot(f1,c(0,1))$root)
f2 = function(x){log(exp(x)*expm1(x))-(log(2.28^2) -2*log(10.58))}
sqrt(uniroot(f2,c(0,1))$root)
X <- iSpline(doses,knots=seq(30,90,20),intercept=TRUE)
library(splines2)
doses <- seq(0,100,0.5)
X <- iSpline(doses,knots=seq(30,90,20),intercept=TRUE)
bkg = c(10.58,10.58,481,481)
lambda <- c(227.8176,227.8176,18528.14,18528.14)
i = 3
mean = X%*%t(iS[i,,drop=F]) + bkg[i]
isM <- splinefun(doses,mean)
dim(X)
dim(iS)
beta1 <- c(0.15486274,0.14054532,0.05806702,0.67421470,0.18371405,0.92821744,1.60669594,1.04508522)
beta2 <- c(0.677816175,0.322787366,3.356424380,0.102841870,0.009085238,0.087907971,0.344255936,0.100000000)
#add 481 to get the background
beta3 <- c(-45.715480,-53.668821,-14.266726, -8.066441,-1.620326 ,-1.800000,-1.800000 ,-1.800000)
beta4 <- c(-11.9566632,-19.9908719,-39.3450020,-16.3895141,-2.8191037,-4.5801731,-0.834784,-0.7000000)
iSpline <- rbind(beta1,beta2,beta3,beta4)
iS <- data.frame(b1=iSpline[,1],b2=iSpline[,2],b3 = iSpline[,3],
b4=iSpline[,4],b5=iSpline[,5],b6 = iSpline[,6],
b7=iSpline[,7],b8=iSpline[,8])
iS
mean = X%*%t(iS[i,,drop=F]) + bkg[i]
isM <- splinefun(doses,mean)
plot(doses,isM(doses))
dr <- seq(0,100,0.001)
plot(dr,isM(dr))
plot(doses,isM(doses),line='l')
plot(doses,isM(doses),type = ='l')
plot(doses,isM(doses),type ='l')
i = 4
mean = X%*%t(iS[i,,drop=F]) + bkg[i]
isM <- splinefun(doses,mean)
plot(doses,mean)
load("~/Documents/r_software/RBMDS/Simulation/Non-Parametric/results/simrun_NP_lognormal_g_5_sim_4.Rdata")
plot(doses,sim_data[1,])
load("~/Documents/r_software/RBMDS/Simulation/Non-Parametric/NP_lognormal_g_5_sim_4.Rdata")
plot(doses,sim_data[1,])
jj = 1
y = sim_data[jj,]
BB <- ma_continuous_fit(as.matrix(doses),as.matrix(y),model_list=model_list2,
fit_type = "mcmc",BMD_TYPE = 'hybrid',BMR = 0.05,point_p = 0.025,samples = 75000)
model_list  = data.frame(model_list = c(rep("hill",2),rep("exp-3",3),rep("exp-5",3),rep("power",2)),
distribution_list =  c(c("normal","normal-ncv"),rep(c("normal","normal-ncv","lognormal"),2),
"normal", "normal-ncv"))
model_list2 = data.frame(model_list = c(rep("hill",1),rep("exp-3",1),rep("exp-5",1),rep("power",1)),
distribution_list =  c(rep(c("normal"),4)))
BB <- ma_continuous_fit(as.matrix(doses),as.matrix(y),model_list=model_list2,
fit_type = "mcmc",BMD_TYPE = 'hybrid',BMR = 0.05,point_p = 0.025,samples = 75000)
plot(BB)
dr = seq(0,100,0.5)
lines(dr,isM(dr))
library(ToxicR)
plot(BB)
lines(dr,isM(dr))
lines(dr,isM(dr),col=3,lwd=3)
load("~/Documents/r_software/RBMDS/Simulation/Non-Parametric/NP_lognormal_g_5_sim_4.Rdata")
load("~/Documents/r_software/RBMDS/Simulation/Non-Parametric/results/simrun_NP_lognormal_g_5_sim_4.Rdata")
View(BMD_result_SD_ML2_mcmc)
j = 3
plot(doses,y)
y = sim_data[j,]
plot(doses,y)
BB <- ma_continuous_fit(as.matrix(doses),as.matrix(y),model_list=model_list2,
fit_type = "mcmc",BMD_TYPE = 'hybrid',BMR = 0.05,point_p = 0.025,samples = 75000)
plot(BB)
BB$bmd
View(BMD_result_HB_ML2_mcmc)
j = 4
BB <- ma_continuous_fit(as.matrix(doses),as.matrix(y),model_list=model_list2,
fit_type = "mcmc",BMD_TYPE = 'hybrid',BMR = 0.05,point_p = 0.025,samples = 75000)
plot(BB)
y = sim_data[j,]
BB <- ma_continuous_fit(as.matrix(doses),as.matrix(y),model_list=model_list2,
fit_type = "mcmc",BMD_TYPE = 'hybrid',BMR = 0.05,point_p = 0.025,samples = 75000)
plot(BB)
dose_g_5 <- rep(c(0,6.25,12.5,25,50,100),each=20)
X_g_5 <- iSpline(dose_g_5,knots=seq(30,90,20))
library(splines2)
X_g_5 <- iSpline(dose_g_5,knots=seq(30,90,20))
sim_data <- matrix(rlnorm(1000*length(dose_g_5),log(means_g_5),sd[i]),nrow=1000,ncol=length(dose_g_5),byrow=T)
means_g_5 <- X_g_5%*%t(iS[i,,drop=F]) + bkg[i]
sim_data <- matrix(rlnorm(1000*length(dose_g_5),log(means_g_5),sd[i]),nrow=1000,ncol=length(dose_g_5),byrow=T)
sd    <- c(rep(0.209,2),rep(0.158,2))
sim_data <- matrix(rlnorm(1000*length(dose_g_5),log(means_g_5),sd[i]),nrow=1000,ncol=length(dose_g_5),byrow=T)
plot(doses,sim_data[1,])
plot(dose_g_5,sim_data[1,])
doses = doze_g_5
doses = dose_g_5
y = sim_data[j,]
BB <- ma_continuous_fit(as.matrix(doses),as.matrix(y),model_list=model_list2,
fit_type = "mcmc",BMD_TYPE = 'hybrid',BMR = 0.05,point_p = 0.025,samples = 75000)
plot(BB)
lines(dr,isM(dr),col=3,lwd=2)
j = 2
y = sim_data[j,]
BB <- ma_continuous_fit(as.matrix(doses),as.matrix(y),model_list=model_list2,
fit_type = "mcmc",BMD_TYPE = 'hybrid',BMR = 0.05,point_p = 0.025,samples = 75000)
plot(BB)
print(BB$bmd[,2])
print(BB$bmd[2])
for (j = 1:10){
y  <- sim_data[j,]
BB <- ma_continuous_fit(as.matrix(doses),as.matrix(y),model_list=model_list2,
+                               fit_type = "mcmc",BMD_TYPE = 'hybrid',BMR = 0.05,point_p = 0.025,samples = 75000)
print(BB$bmd[2])
}
for (j in 1:10){
y  <- sim_data[j,]
BB <- ma_continuous_fit(as.matrix(doses),as.matrix(y),model_list=model_list2,
+                               fit_type = "mcmc",BMD_TYPE = 'hybrid',BMR = 0.05,point_p = 0.025,samples = 75000)
print(BB$bmd[2])
}
for (j in 1:10){}
for (j in 1:10){
y  <- sim_data[j,]
BB <- ma_continuous_fit(as.matrix(doses),as.matrix(y),model_list=model_list2,
+                               fit_type = "mcmc",BMD_TYPE = 'hybrid',BMR = 0.05,point_p = 0.025,samples = 75000)
print(BB$bmd[2])
}
for (j  1:10){
y  <- sim_data[j,]
BB <- ma_continuous_fit(as.matrix(doses),as.matrix(y),model_list=model_list2,
fit_type = "mcmc",BMD_TYPE = 'hybrid',BMR = 0.05,point_p = 0.025,samples = 75000)
print(BB$bmd[2])
}
for (j in 1:10){
y  <- sim_data[j,]
BB <- ma_continuous_fit(as.matrix(doses),as.matrix(y),model_list=model_list2,
fit_type = "mcmc",BMD_TYPE = 'hybrid',BMR = 0.05,point_p = 0.025,samples = 75000)
print(BB$bmd[2])
}
for (j in 1:20){
y  <- sim_data[j,]
BB <- ma_continuous_fit(as.matrix(doses),as.matrix(y),model_list=model_list2,
fit_type = "mcmc",BMD_TYPE = 'hybrid',BMR = 0.05,point_p = 0.025,samples = 75000)
print(BB$bmd[2])
}
3/20
bmdls <- rep(0,1000)
for (j in 1:1000){
y  <- sim_data[j,]
BB <- ma_continuous_fit(as.matrix(doses),as.matrix(y),model_list=model_list2,
fit_type = "mcmc",BMD_TYPE = 'hybrid',BMR = 0.05,point_p = 0.025,samples = 75000)
bmdls[j] = BB$bmd[2]
print(j)
}
mean(bmdls < 20.99)
bmdls <- rep(0,1000)
for (j in 1:1000){
y  <- sim_data[j,]
BB <- ma_continuous_fit(as.matrix(doses),as.matrix(y),model_list=model_list2,
fit_type = "laplace",BMD_TYPE = 'hybrid',BMR = 0.05,point_p = 0.025,samples = 75000)
bmdls[j] = BB$bmd[2]
print(j)
}
c = single_continuous_fit(as.matrix(doses),as.matrix(y),sstat=F,BMD_TYPE="sd",BMR=1, distribution = "normal",fit_type="laplace",model_type = "hill")
c$covariance
mean(bmdls < 22.99)
mean(bmdls < 20.99)
which(bmdls > 20.99)
j = 14
library(ToxicR)
bmdls[14]
Q = which(bmdls > 20.99)
y  <- sim_data[j,]
BB <- ma_continuous_fit(as.matrix(doses),as.matrix(y),model_list=model_list2,
fit_type = "laplace",BMD_TYPE = 'hybrid',BMR = 0.05,point_p = 0.025,samples = 75000)
BB$bmd
BB$posterior_probs
model_list  = data.frame(model_list = c(rep("hill",2),rep("exp-3",3),rep("exp-5",3),rep("power",2)),
distribution_list =  c(c("normal","normal-ncv"),rep(c("normal","normal-ncv","lognormal"),2),
"normal", "normal-ncv"))
BB2 <- ma_continuous_fit(as.matrix(doses),as.matrix(y),model_list=model_list,
fit_type = "laplace",BMD_TYPE = 'hybrid',BMR = 0.05,point_p = 0.025,samples = 75000)
BB2$bmd
BB2$posterior_probs
plot(BB2)
model_list2 = data.frame(model_list = c(rep("hill",1),rep("exp-3",1),rep("exp-5",1),rep("power",1)),
distribution_list =  c(rep(c("normal-ncv"),4)))
BB2 <- ma_continuous_fit(as.matrix(doses),as.matrix(y),model_list=model_list2,
fit_type = "laplace",BMD_TYPE = 'hybrid',BMR = 0.05,point_p = 0.025,samples = 75000)
plot(BB2)
BB2$posterior_probs
library(ToxicR)
v1 <- c(13.184152,12.8906975,12.359554,13.073001,12.861814,12.967434,12.88052,
13.249991,	12.992931,	13.022338,	13.614057,	13.287018,	13.449239,	13.950747,
13.239134,	13.82321,	15.080262,	14.85966,	14.7805395,	15.238369,	14.749196,
14.913585,	15.181719,	15.051697,	15.065641,	15.16396,	15.484345,	16.493923,
15.633442,	15.96033,	15.388061)
prior <- create_prior_list(lnormprior(0,1,-100,100),
normprior( 0, 1,-100,100),#normprior(1,2,-18,18),
lnormprior(0 ,1,0,100),
lnormprior(0,1,0,18),
normprior(0,2,-18,18));
library(readr)
PFOA_Liver <- read_table2("~/Documents/PFOA_Liver.txt",
col_names = FALSE)
doses	<- c(0,	0,	0,	0,	0.156,	0.156,	0.156,	0.3125,	0.3125,	0.3125,
0.625,	0.625,	0.625,	1.25,	1.25,	1.25,	2.5,	2.5,	2.5,	5,5,
5,	5,	10,	10,	10,	10,	20,	20,	20,	20)
#B <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", fit_type = "laplace",sstat = F)
#BB <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal",fit_type = "mle",sstat = F,)
library(dplyr)
temp <- PFOA_Liver %>% filter(X1 == "IGFBP1_32306")
v1 <- as.numeric(temp[2:length(temp)])
BB <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal-ncv",fit_type = "mle",sstat = F,)
BB$maximum
plot(BB)
library(ToxicR)
v1 <- c(13.184152,12.8906975,12.359554,13.073001,12.861814,12.967434,12.88052,
13.249991,	12.992931,	13.022338,	13.614057,	13.287018,	13.449239,	13.950747,
13.239134,	13.82321,	15.080262,	14.85966,	14.7805395,	15.238369,	14.749196,
14.913585,	15.181719,	15.051697,	15.065641,	15.16396,	15.484345,	16.493923,
15.633442,	15.96033,	15.388061)
prior <- create_prior_list(lnormprior(0,1,-100,100),
normprior( 0, 1,-100,100),#normprior(1,2,-18,18),
lnormprior(0 ,1,0,100),
lnormprior(0,1,0,18),
normprior(0,2,-18,18));
library(readr)
PFOA_Liver <- read_table2("~/Documents/PFOA_Liver.txt",
col_names = FALSE)
doses	<- c(0,	0,	0,	0,	0.156,	0.156,	0.156,	0.3125,	0.3125,	0.3125,
0.625,	0.625,	0.625,	1.25,	1.25,	1.25,	2.5,	2.5,	2.5,	5,5,
5,	5,	10,	10,	10,	10,	20,	20,	20,	20)
#B <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", fit_type = "laplace",sstat = F)
#BB <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal",fit_type = "mle",sstat = F,)
library(dplyr)
temp <- PFOA_Liver %>% filter(X1 == "IGFBP1_32306")
v1 <- as.numeric(temp[2:length(temp)])
BB <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal-ncv",fit_type = "mle",sstat = F,)
BB$maximum
temp <- PFOA_Liver %>% filter(X1 == "GAS5_8688")
v1 <- as.numeric(temp[2:length(temp)])
BB <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal-ncv",fit_type = "mle",sstat = F,)
plot(BB)
BB$maximum
library(ToxicR
)
library(ToxicR)
v1 <- c(13.184152,12.8906975,12.359554,13.073001,12.861814,12.967434,12.88052,
13.249991,	12.992931,	13.022338,	13.614057,	13.287018,	13.449239,	13.950747,
13.239134,	13.82321,	15.080262,	14.85966,	14.7805395,	15.238369,	14.749196,
14.913585,	15.181719,	15.051697,	15.065641,	15.16396,	15.484345,	16.493923,
15.633442,	15.96033,	15.388061)
prior <- create_prior_list(lnormprior(0,1,-100,100),
normprior( 0, 1,-100,100),#normprior(1,2,-18,18),
lnormprior(0 ,1,0,100),
lnormprior(0,1,0,18),
normprior(0,2,-18,18));
library(readr)
PFOA_Liver <- read_table2("~/Documents/PFOA_Liver.txt",
col_names = FALSE)
doses	<- c(0,	0,	0,	0,	0.156,	0.156,	0.156,	0.3125,	0.3125,	0.3125,
0.625,	0.625,	0.625,	1.25,	1.25,	1.25,	2.5,	2.5,	2.5,	5,5,
5,	5,	10,	10,	10,	10,	20,	20,	20,	20)
#B <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", fit_type = "laplace",sstat = F)
#BB <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal",fit_type = "mle",sstat = F,)
library(dplyr)
temp <- PFOA_Liver %>% filter(X1 == "GAS5_8688")
v1 <- as.numeric(temp[2:length(temp)])
BB <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal-ncv",fit_type = "mle",sstat = F,)
library(ToxicR)
v1 <- c(13.184152,12.8906975,12.359554,13.073001,12.861814,12.967434,12.88052,
13.249991,	12.992931,	13.022338,	13.614057,	13.287018,	13.449239,	13.950747,
13.239134,	13.82321,	15.080262,	14.85966,	14.7805395,	15.238369,	14.749196,
14.913585,	15.181719,	15.051697,	15.065641,	15.16396,	15.484345,	16.493923,
15.633442,	15.96033,	15.388061)
prior <- create_prior_list(lnormprior(0,1,-100,100),
normprior( 0, 1,-100,100),#normprior(1,2,-18,18),
lnormprior(0 ,1,0,100),
lnormprior(0,1,0,18),
normprior(0,2,-18,18));
library(readr)
PFOA_Liver <- read_table2("~/Documents/PFOA_Liver.txt",
col_names = FALSE)
doses	<- c(0,	0,	0,	0,	0.156,	0.156,	0.156,	0.3125,	0.3125,	0.3125,
0.625,	0.625,	0.625,	1.25,	1.25,	1.25,	2.5,	2.5,	2.5,	5,5,
5,	5,	10,	10,	10,	10,	20,	20,	20,	20)
#B <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", fit_type = "laplace",sstat = F)
#BB <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal",fit_type = "mle",sstat = F,)
library(dplyr)
temp <- PFOA_Liver %>% filter(X1 == "GAS5_8688")
v1 <- as.numeric(temp[2:length(temp)])
B  <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal",fit_type = "mle",sstat = F,)
BB <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal-ncv",fit_type = "mle",sstat = F,)
2*[5.61-3.64]
2*(5.61-3.64)
GAS5_8688
temp <- PFOA_Liver %>% filter(X1 == "GAS5_8688")
v1 <- as.numeric(temp[2:length(temp)])
B  <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal",fit_type = "mle",sstat = F,)
BB <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal-ncv",fit_type = "mle",sstat = F,)
library(ToxicR)
v1 <- c(13.184152,12.8906975,12.359554,13.073001,12.861814,12.967434,12.88052,
13.249991,	12.992931,	13.022338,	13.614057,	13.287018,	13.449239,	13.950747,
13.239134,	13.82321,	15.080262,	14.85966,	14.7805395,	15.238369,	14.749196,
14.913585,	15.181719,	15.051697,	15.065641,	15.16396,	15.484345,	16.493923,
15.633442,	15.96033,	15.388061)
prior <- create_prior_list(lnormprior(0,1,-100,100),
normprior( 0, 1,-100,100),#normprior(1,2,-18,18),
lnormprior(0 ,1,0,100),
lnormprior(0,1,0,18),
normprior(0,2,-18,18));
library(readr)
PFOA_Liver <- read_table2("~/Documents/PFOA_Liver.txt",
col_names = FALSE)
doses	<- c(0,	0,	0,	0,	0.156,	0.156,	0.156,	0.3125,	0.3125,	0.3125,
0.625,	0.625,	0.625,	1.25,	1.25,	1.25,	2.5,	2.5,	2.5,	5,5,
5,	5,	10,	10,	10,	10,	20,	20,	20,	20)
#B <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", fit_type = "laplace",sstat = F)
#BB <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal",fit_type = "mle",sstat = F,)
library(dplyr)
temp <- PFOA_Liver %>% filter(X1 == "GAS5_8688")
v1 <- as.numeric(temp[2:length(temp)])
B  <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal",fit_type = "mle",sstat = F,)
BB <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal-ncv",fit_type = "mle",sstat = F,)
library(ToxicR)
v1 <- c(13.184152,12.8906975,12.359554,13.073001,12.861814,12.967434,12.88052,
13.249991,	12.992931,	13.022338,	13.614057,	13.287018,	13.449239,	13.950747,
13.239134,	13.82321,	15.080262,	14.85966,	14.7805395,	15.238369,	14.749196,
14.913585,	15.181719,	15.051697,	15.065641,	15.16396,	15.484345,	16.493923,
15.633442,	15.96033,	15.388061)
prior <- create_prior_list(lnormprior(0,1,-100,100),
normprior( 0, 1,-100,100),#normprior(1,2,-18,18),
lnormprior(0 ,1,0,100),
lnormprior(0,1,0,18),
normprior(0,2,-18,18));
library(readr)
PFOA_Liver <- read_table2("~/Documents/PFOA_Liver.txt",
col_names = FALSE)
doses	<- c(0,	0,	0,	0,	0.156,	0.156,	0.156,	0.3125,	0.3125,	0.3125,
0.625,	0.625,	0.625,	1.25,	1.25,	1.25,	2.5,	2.5,	2.5,	5,5,
5,	5,	10,	10,	10,	10,	20,	20,	20,	20)
#B <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", fit_type = "laplace",sstat = F)
#BB <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal",fit_type = "mle",sstat = F,)
library(dplyr)
temp <- PFOA_Liver %>% filter(X1 == "GAS5_8688")
v1 <- as.numeric(temp[2:length(temp)])
B  <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal",fit_type = "mle",sstat = F,)
BB <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal-ncv",fit_type = "mle",sstat = F,)
plot(BB)
unique(doses)
pchisq(5,3.9)
pchisq(3.95,5)
temp <- PFOA_Liver %>% filter(X1 == "CYP3A1_32809")
v1 <- as.numeric(temp[2:length(temp)])
B  <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal",fit_type = "mle",sstat = F,)
BB <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal-ncv",fit_type = "mle",sstat = F,)
plot(BB)
plot(B)
B  <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "FUNL", distribution="normal",fit_type = "mle",sstat = F,)
B  <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "FUNL", distribution="normal",fit_type = "laplace",sstat = F,)
plot(B)
temp <- PFOA_Liver %>% filter(X1 == "ACADL_32776")
B  <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "FUNL", distribution="normal",fit_type = "laplace",sstat = F,)
plot(B)
BB <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "HILL", distribution="normal",fit_type = "mcmc",sstat = F,)
BB <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal",fit_type = "mle",sstat = F,)
plot(BB)
BB <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal",fit_type = "mle",sstat = F,)
plot(BB)
temp <- PFOA_Liver %>% filter(X1 == "CYP3A1_32809")
v1 <- as.numeric(temp[2:length(temp)])
temp <- PFOA_Liver %>% filter(X1 == "CYP3A1_32809")
v1 <- as.numeric(temp[2:length(temp)])
B  <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal",fit_type = "laplace",sstat = F,)
plot(B)
BB <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal-ncv",fit_type = "mle",sstat = F,)
plot(BB)
BB <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal-ncv",fit_type = "laplace",sstat = F,)
plot(BB)
B  <- single_continuous_fit(as.matrix(doses),as.matrix(v1),model_type = "hill", distribution="normal",fit_type = "mle",sstat = F,)
plot(B)
B$covariance
